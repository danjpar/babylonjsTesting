<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>Babylon.js demo</title>
<style>
html,body,canvas { margin: 0; padding: 0; width: 100%; height: 100%; font-size: 0; }
</style>
</head>
<body>
<script src='babylon.max.js'></script>
<canvas id='render-canvas'></canvas>
<script>
    var canvas = document.getElementById('render-canvas');
    var engine = new BABYLON.Engine(canvas);
    engine.enableOfflineSupport = false;

    var scene = new BABYLON.Scene(engine);
    scene.clearColor = new BABYLON.Color3(0.8, 0.8, 0.8);

    var light = new BABYLON.PointLight('Omni', new BABYLON.Vector3(0, 0, 0), scene);

    scene.onBeforeRenderObservable.add(function () {     
        light.position = camera.position.clone();
    });

    var camera = new BABYLON.ArcRotateCamera('Camera', 0, 0, 30, new BABYLON.Vector3(0,0,0), scene);
    //camera.beta = Math.PI/2;
    camera.attachControl(canvas, false);
    camera.zoomingSensibility = 25;
    camera.panningSensibility = 50;

    var sourceMat = new BABYLON.StandardMaterial('sourceMat', scene);
    sourceMat.diffuseColor = new BABYLON.Color3(0.2,0.2,0.2),
    sourceMat.specularColor = BABYLON.Color3.Black();
    sourceMat.backFaceCulling = true;

    var alpha = Math.PI;

    cube = BABYLON.MeshBuilder.CreateBox('cube', {  }, scene);
    cube.scaling.y = 2;
    cube.bakeCurrentTransformIntoVertices();
    cube.position.x = Math.sin(alpha)*10;
    cube.position.z = Math.cos(alpha)*10;
    cube.computeWorldMatrix(true);

    newTrail = new BABYLON.TrailMesh('new', cube, scene, .5, 60, sourceMat, true);

    observer = scene.onBeforeRenderObservable.add(animate);
    function animate() {
        alpha += Math.PI/120;
        cube.position.x = Math.sin(alpha)*10;
        cube.position.z = Math.cos(alpha)*10;
        cube.rotation.x = Math.PI*alpha/2;
        cube.rotation.y = alpha;
        if (alpha >= Math.PI*9) {alpha = alpha - Math.PI*8;}
    }
/*
    setTimeout(function() {
        scene.onBeforeRenderObservable.remove(observer);
        newTrail.stop()
    }, 5000);
*/
    var renderLoop = function () {
        scene.render();
    };
    engine.runRenderLoop(renderLoop);

</script>
</body>
</html>
